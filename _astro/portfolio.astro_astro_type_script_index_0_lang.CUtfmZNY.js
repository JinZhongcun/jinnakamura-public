document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".works-section .filter-btn"),t=document.querySelectorAll(".insights-section .filter-btn"),o=document.querySelectorAll(".works-grid .work-card"),s=document.querySelectorAll(".insights-grid .insight-card");e.forEach(l=>{l.addEventListener("click",function(){const d=this.dataset.filter;e.forEach(c=>c.classList.remove("active")),this.classList.add("active"),o.forEach(c=>{d==="all"||(c.dataset.tags||"").includes(d)?c.classList.remove("hidden"):c.classList.add("hidden")})})}),t.forEach(l=>{l.addEventListener("click",function(){const d=this.dataset.filter;t.forEach(c=>c.classList.remove("active")),this.classList.add("active"),s.forEach(c=>{d==="all"||(c.dataset.tags||"").includes(d)?c.classList.remove("hidden"):c.classList.add("hidden")})})}),document.addEventListener("click",function(l){const d=l.target.closest(".clickable-section-nav");if(d){const c=d.dataset.target;console.log("🧭 セクションナビゲーション:",c),a(),u(),setTimeout(()=>{const y=document.getElementById(c);y&&(console.log("📜 セクションにスクロール:",c),y.scrollIntoView({behavior:"smooth",block:"start"}))},100);return}});const i=document.getElementById("back-to-insights");i&&i.addEventListener("click",u),document.querySelectorAll(".clickable-back-to-list").forEach(l=>{l.addEventListener("click",function(){document.querySelector(".insight-detail-section:not(.hidden)")?u():a()})});const g=document.getElementById("back-to-list-card");g&&g.addEventListener("click",a),document.querySelectorAll(".back-to-list-card").forEach(l=>{l.addEventListener("click",a)});const n=window.location.hash.slice(1);if(n){if(document.getElementById(n)&&document.getElementById(n).classList.contains("work-detail-section")){const l=document.getElementById("works");l?(l.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{f(n)},500)):f(n)}else if(document.getElementById(n)&&document.getElementById(n).classList.contains("insight-detail-section")){const l=document.getElementById("insights");l?(l.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{k(n)},500)):k(n)}}window.addEventListener("popstate",function(){const l=window.location.hash.slice(1);l?document.getElementById(l)&&document.getElementById(l).classList.contains("work-detail-section")?f(l):document.getElementById(l)&&document.getElementById(l).classList.contains("insight-detail-section")&&k(l):(a(),u())})});function k(e){document.querySelector(".work-detail-section:not(.hidden), .insight-detail-section:not(.hidden)")&&(document.querySelectorAll(".work-detail-section").forEach(s=>{s.classList.add("hidden")}),document.querySelectorAll(".insight-detail-section").forEach(s=>{s.classList.add("hidden")}),document.querySelector(".works-section").style.display="block",document.querySelector(".insights-section").style.display="block",m(),S());const o=document.querySelector(`.insight-card[data-href="#${e}"]`);if(window.history.pushState(null,null,`#${e}`),o)p(o,()=>{document.querySelector(".insights-section").style.display="none";const s=document.getElementById(e);s&&(s.classList.remove("hidden"),w(e),setTimeout(()=>{v(o)},100))});else{document.querySelector(".insights-section").style.display="none";const s=document.getElementById(e);s&&(s.classList.remove("hidden"),w(e))}}function u(){window.history.pushState(null,null,"/ja/portfolio"),document.querySelectorAll(".work-detail-section").forEach(e=>{e.classList.add("hidden")}),document.querySelectorAll(".insight-detail-section").forEach(e=>{e.classList.add("hidden")}),m(),S(),document.querySelector(".works-section").style.display="block",document.querySelector(".insights-section").style.display="block"}function f(e){document.querySelectorAll(".work-detail-section").forEach(o=>{o.classList.add("hidden")}),document.querySelectorAll(".insight-detail-section").forEach(o=>{o.classList.add("hidden")}),m();const t=document.querySelector(`.work-card[data-href="#${e}"]`)||document.querySelector(`.topic-tile [data-href="#${e}"]`)?.closest(".topic-tile");if(window.history.pushState(null,null,`#${e}`),t)p(t,()=>{document.querySelector(".works-section").style.display="none",document.querySelector(".insights-section").style.display="block";const o=document.getElementById(e);o&&(o.classList.remove("hidden"),b(e),setTimeout(()=>{q(t)},100))});else{document.querySelector(".works-section").style.display="none",document.querySelector(".insights-section").style.display="block";const o=document.getElementById(e);o&&o.classList.remove("hidden")}}function p(e,t){e.classList.add("selected"),setTimeout(()=>{t()},100)}function a(){window.history.pushState(null,null,"/ja/portfolio"),document.querySelectorAll(".work-detail-section").forEach(e=>{e.classList.add("hidden")}),document.querySelectorAll(".insight-detail-section").forEach(e=>{e.classList.add("hidden")}),m(),S(),document.querySelector(".works-section").style.display="block",document.querySelector(".insights-section").style.display="block"}function S(){document.querySelectorAll(".work-card, .insight-card").forEach(t=>{t.classList.remove("selected")})}function q(e){const t=document.querySelector(".work-detail-section:not(.hidden)");if(!t)return;const o=t.querySelector(".selected-card-display"),s=t.querySelector(".selected-card-container");if(!o||!s)return;const i=e.cloneNode(!0);i.classList.remove("clickable-work","selected-simple"),s.innerHTML="",s.appendChild(i),o.style.display="block"}function v(e){const t=document.querySelector(".insight-detail-section:not(.hidden)");if(!t)return;const o=t.querySelector(".selected-card-display"),s=t.querySelector(".selected-card-container");if(!o||!s)return;const i=e.cloneNode(!0);i.classList.remove("clickable-insight","selected-simple"),s.innerHTML="",s.appendChild(i),o.style.display="block"}function m(){document.querySelectorAll(".selected-card-display").forEach(t=>{t.style.display="none"})}function L(e,t="work"){const o=t==="work"?".works-grid":".insights-grid",s=document.querySelector(o);return s?Array.from(s.querySelectorAll(t==="work"?".work-card":".insight-card")).filter(h=>{const n=h.dataset.href;return n&&n!==`#${e}`}).slice(0,3).map(h=>{let n=h.outerHTML;return n=n.replace(t==="work"?'class="work-card clickable-work"':'class="insight-card clickable-insight"',t==="work"?'class="work-card clickable-work related-work-card"':'class="insight-card clickable-insight related-insight-card"'),n}).join(""):(console.error(`元の${t}グリッドが見つかりません`),"")}function b(e){console.log("🔄 自動配線システム開始:",e);const t=document.querySelector(`#${e} .related-works`);if(t){console.log("✅ 関連ワークスセクション発見、メインカードから自動生成...");const s=`
						<!-- 一覧に戻るボタン（画面いっぱい横展開） -->
						<div class="back-to-list-full-width back-to-list-card">
							一覧に戻る
						</div>
						
						<!-- 他のプロジェクトタイトル -->
						<h3>他のプロジェクト</h3>
						
						<!-- プロジェクトカード（メインWorksから自動コピー・完全同一） -->
						<div class="works-grid">
							${L(e,"work")}
						</div>
					`;t.innerHTML=s,console.log("🎯 自動配線完了、カード数:",t.querySelectorAll(".clickable-work").length);const i=t.querySelector(".works-grid");i?(console.log("🎨 JavaScriptで直接スタイル適用開始..."),i.style.display="grid",i.style.gridTemplateColumns="repeat(auto-fit, minmax(280px, 1fr))",i.style.gap="1.5rem",i.style.width="100%",i.style.justifyItems="start",console.log("✅ JavaScriptスタイル適用完了!",i)):console.error("❌ works-grid要素が見つかりません");const r=t.querySelector(".back-to-list-card");r&&r.addEventListener("click",a)}else console.error("❌ 関連ワークスセクションが見つかりません:",e)}function w(e){console.log("🔄 Insights自動配線システム開始:",e);const t=document.querySelector(`#${e} .related-insights`);if(t){console.log("✅ 関連Insightsセクション発見、メインカードから自動生成...");const s=`
						<!-- 一覧に戻るボタン（画面いっぱい横展開） -->
						<div class="back-to-list-full-width back-to-list-card">
							一覧に戻る
						</div>
						
						<!-- 他の記事タイトル -->
						<h3>他の記事</h3>
						
						<!-- 記事カード（メインInsightsから自動コピー・完全同一） -->
						<div class="insights-grid">
							${L(e,"insight")}
						</div>
					`;t.innerHTML=s,console.log("🎯 Insights自動配線完了、カード数:",t.querySelectorAll(".clickable-insight").length);const i=t.querySelector(".insights-grid");i&&(console.log("🎨 Insights JavaScriptで直接スタイル適用開始..."),i.style.display="grid",i.style.gridTemplateColumns="repeat(auto-fit, minmax(280px, 1fr))",i.style.gap="1.5rem",i.style.width="100%",i.style.justifyItems="start",console.log("✅ Insights JavaScriptスタイル適用完了!",i));const r=t.querySelector(".back-to-list-card");r&&r.addEventListener("click",u)}else console.error("❌ 関連Insightsセクションが見つかりません:",e)}
