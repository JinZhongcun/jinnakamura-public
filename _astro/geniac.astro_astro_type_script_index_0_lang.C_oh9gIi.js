document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".works-section .filter-btn"),t=document.querySelectorAll(".insights-section .filter-btn"),c=document.querySelectorAll(".works-grid .work-card"),i=document.querySelectorAll(".insights-grid .insight-card");e.forEach(s=>{s.addEventListener("click",function(){const l=this.dataset.filter;e.forEach(o=>o.classList.remove("active")),this.classList.add("active"),c.forEach(o=>{l==="all"||(o.dataset.tags||"").includes(l)?o.classList.remove("hidden"):o.classList.add("hidden")})})}),t.forEach(s=>{s.addEventListener("click",function(){const l=this.dataset.filter;t.forEach(o=>o.classList.remove("active")),this.classList.add("active"),i.forEach(o=>{l==="all"||(o.dataset.tags||"").includes(l)?o.classList.remove("hidden"):o.classList.add("hidden")})})}),document.addEventListener("click",function(s){const l=s.target.closest(".clickable-insight");if(l){const o=l.dataset.href,r=l.getAttribute("href");if(console.log("📋 Insightクリック:",o,"href:",r),r&&r.startsWith("/ja/portfolio/")&&!r.includes("#")){console.log("🌐 Insight URL遷移なのでデフォルト動作を許可:",r);return}o&&o.startsWith("#")?(s.preventDefault(),l.closest(".related-insights")?(u(),h(),setTimeout(()=>{const g=document.getElementById("insights");g&&(g.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{S(o.slice(1))},800))},100)):(console.log("メインInsightsカードクリック:",o),S(o.slice(1)))):console.log("⚠️ Insight targetIdが無効またはURL遷移:",o,r)}}),document.addEventListener("click",function(s){const l=s.target.closest(".clickable-section-nav");if(l){const o=l.dataset.target;console.log("🧭 セクションナビゲーション:",o),u(),h(),setTimeout(()=>{const r=document.getElementById(o);r&&(console.log("📜 セクションにスクロール:",o),r.scrollIntoView({behavior:"smooth",block:"start"}))},100);return}}),document.addEventListener("click",function(s){console.log("🖱️ クリックイベント発生:",s.target);const l=s.target.closest(".clickable-work");if(console.log("🎯 .clickable-work 要素:",l),l){const o=l.dataset.href,r=l.getAttribute("href");if(console.log("📋 クリックされたカード:",o,"href:",r,"カード要素:",l),r&&r.startsWith("/ja/portfolio/")&&!r.includes("#")){console.log("🌐 URL遷移なのでデフォルト動作を許可:",r);return}if(o&&o.startsWith("#")){s.preventDefault(),console.log("🔍 カードのクラス一覧:",l.className),console.log("🏷️ カードのdata属性:",l.dataset);const g=l.closest(".topics-section"),L=l.closest(".works-section"),b=l.closest(".related-works");console.log("🔎 親要素検索結果:"),console.log("  - topics-section:",g),console.log("  - works-section:",L),console.log("  - related-works:",b),console.log("  - 現在のURL:",window.location.href),g||L||b?(console.log("✨ 特別遷移処理開始:",o),console.log("📤 現在のページを閉じます..."),u(),h(),setTimeout(()=>{const w=document.getElementById("works");console.log("🎯 Worksセクション検索結果:",w),w?(console.log("📜 Worksセクションにスクロール開始..."),w.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{console.log("🚀 新しいプロジェクト詳細を表示:",o.slice(1)),f(o.slice(1))},800)):console.error("❌ Worksセクションが見つかりません")},100)):(console.log("➡️ メインWorksカード - 直接遷移:",o),f(o.slice(1)))}else console.log("⚠️ targetIdが無効またはURL遷移:",o,r)}else console.log("❌ .clickable-work 要素が見つかりません")});const n=document.getElementById("back-to-insights");n&&n.addEventListener("click",h),document.querySelectorAll(".clickable-back-to-list").forEach(s=>{s.addEventListener("click",function(l){l.preventDefault(),l.stopPropagation(),console.log("🔙 一覧に戻る: /ja/portfolio#works へ遷移"),window.location.replace("/ja/portfolio#works")})});const m=document.getElementById("back-to-list-card");m&&m.addEventListener("click",u),document.querySelectorAll(".back-to-list-card").forEach(s=>{s.addEventListener("click",u)}),console.log("🎯 geniacページ: GENIACプロジェクトを自動選択");const a=document.getElementById("works");a&&(a.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{console.log("📋 GENIACプロジェクト詳細を自動表示"),f("geniac-project-detail");const s=document.querySelector('.work-card[data-href="#geniac-project-detail"]');s&&updateSelectedCard(s)},800)),window.location.hash.slice(1),window.addEventListener("popstate",function(){const s=window.location.hash.slice(1);s?document.getElementById(s)&&document.getElementById(s).classList.contains("work-detail-section")?f(s):document.getElementById(s)&&document.getElementById(s).classList.contains("insight-detail-section")&&S(s):(u(),h())})});function S(e){document.querySelector(".work-detail-section:not(.hidden), .insight-detail-section:not(.hidden)")&&(document.querySelectorAll(".work-detail-section").forEach(i=>{i.classList.add("hidden")}),document.querySelectorAll(".insight-detail-section").forEach(i=>{i.classList.add("hidden")}),document.querySelector(".works-section").style.display="block",document.querySelector(".insights-section").style.display="block",y(),p());const c=document.querySelector(`.insight-card[data-href="#${e}"]`);if(window.history.pushState(null,null,`#${e}`),c)q(c,()=>{document.querySelector(".insights-section").style.display="none";const i=document.getElementById(e);i&&(i.classList.remove("hidden"),v(e),setTimeout(()=>{A(c)},100))});else{document.querySelector(".insights-section").style.display="none";const i=document.getElementById(e);i&&(i.classList.remove("hidden"),v(e))}}function h(){window.history.pushState(null,null,"/portfolio"),document.querySelectorAll(".work-detail-section").forEach(e=>{e.classList.add("hidden")}),document.querySelectorAll(".insight-detail-section").forEach(e=>{e.classList.add("hidden")}),y(),p(),document.querySelector(".works-section").style.display="block",document.querySelector(".insights-section").style.display="block"}function f(e){document.querySelectorAll(".work-detail-section").forEach(c=>{c.classList.add("hidden")}),document.querySelectorAll(".insight-detail-section").forEach(c=>{c.classList.add("hidden")}),y();const t=document.querySelector(`.work-card[data-href="#${e}"]`)||document.querySelector(`.topic-tile [data-href="#${e}"]`)?.closest(".topic-tile");if(window.history.pushState(null,null,`#${e}`),t)q(t,()=>{document.querySelector(".works-section").style.display="none",document.querySelector(".insights-section").style.display="block";const c=document.getElementById(e);c&&(c.classList.remove("hidden"),T(e),setTimeout(()=>{E(t)},100))});else{document.querySelector(".works-section").style.display="none",document.querySelector(".insights-section").style.display="block";const c=document.getElementById(e);c&&c.classList.remove("hidden")}}function q(e,t){e.classList.add("selected"),setTimeout(()=>{t()},100)}function u(){window.history.pushState(null,null,"/portfolio"),document.querySelectorAll(".work-detail-section").forEach(e=>{e.classList.add("hidden")}),document.querySelectorAll(".insight-detail-section").forEach(e=>{e.classList.add("hidden")}),y(),p(),document.querySelector(".works-section").style.display="block",document.querySelector(".insights-section").style.display="block"}function p(){document.querySelectorAll(".work-card, .insight-card").forEach(t=>{t.classList.remove("selected")})}function E(e){const t=document.querySelector(".work-detail-section:not(.hidden)");if(!t)return;const c=t.querySelector(".selected-card-display"),i=t.querySelector(".selected-card-container");if(!c||!i)return;const n=e.cloneNode(!0);n.classList.remove("clickable-work","selected-simple"),i.innerHTML="",i.appendChild(n),c.style.display="block"}function A(e){const t=document.querySelector(".insight-detail-section:not(.hidden)");if(!t)return;const c=t.querySelector(".selected-card-display"),i=t.querySelector(".selected-card-container");if(!c||!i)return;const n=e.cloneNode(!0);n.classList.remove("clickable-insight","selected-simple"),i.innerHTML="",i.appendChild(n),c.style.display="block"}function y(){document.querySelectorAll(".selected-card-display").forEach(t=>{t.style.display="none"})}function C(e,t="work"){const c=t==="work"?".works-grid":".insights-grid",i=document.querySelector(c);return i?Array.from(i.querySelectorAll(t==="work"?".work-card":".insight-card")).filter(k=>{const a=k.dataset.href;return a&&a!==`#${e}`}).slice(0,3).map(k=>{let a=k.outerHTML;return a=a.replace(t==="work"?'class="work-card clickable-work"':'class="insight-card clickable-insight"',t==="work"?'class="work-card clickable-work related-work-card"':'class="insight-card clickable-insight related-insight-card"'),a}).join(""):(console.error(`元の${t}グリッドが見つかりません`),"")}function T(e){console.log("🔄 自動配線システム開始:",e);const t=document.querySelector(`#${e} .related-works`);if(t){console.log("✅ 関連ワークスセクション発見、メインカードから自動生成...");const i=`
						<!-- 一覧に戻るボタン（画面いっぱい横展開） -->
						<div class="back-to-list-full-width back-to-list-card">
							一覧に戻る
						</div>
						
						<!-- 他のプロジェクトタイトル -->
						<h3>他のプロジェクト</h3>
						
						<!-- プロジェクトカード（メインWorksから自動コピー・完全同一） -->
						<div class="works-grid">
							${C(e,"work")}
						</div>
					`;t.innerHTML=i,console.log("🎯 自動配線完了、カード数:",t.querySelectorAll(".clickable-work").length);const n=t.querySelector(".works-grid");n?(console.log("🎨 JavaScriptで直接スタイル適用開始..."),n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fit, minmax(280px, 1fr))",n.style.gap="1.5rem",n.style.width="100%",n.style.justifyItems="start",console.log("✅ JavaScriptスタイル適用完了!",n)):console.error("❌ works-grid要素が見つかりません");const d=t.querySelector(".back-to-list-card");d&&d.addEventListener("click",u)}else console.error("❌ 関連ワークスセクションが見つかりません:",e)}function v(e){console.log("🔄 Insights自動配線システム開始:",e);const t=document.querySelector(`#${e} .related-insights`);if(t){console.log("✅ 関連Insightsセクション発見、メインカードから自動生成...");const i=`
						<!-- 一覧に戻るボタン（画面いっぱい横展開） -->
						<div class="back-to-list-full-width back-to-list-card">
							一覧に戻る
						</div>
						
						<!-- 他の記事タイトル -->
						<h3>他の記事</h3>
						
						<!-- 記事カード（メインInsightsから自動コピー・完全同一） -->
						<div class="insights-grid">
							${C(e,"insight")}
						</div>
					`;t.innerHTML=i,console.log("🎯 Insights自動配線完了、カード数:",t.querySelectorAll(".clickable-insight").length);const n=t.querySelector(".insights-grid");n&&(console.log("🎨 Insights JavaScriptで直接スタイル適用開始..."),n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fit, minmax(280px, 1fr))",n.style.gap="1.5rem",n.style.width="100%",n.style.justifyItems="start",console.log("✅ Insights JavaScriptスタイル適用完了!",n));const d=t.querySelector(".back-to-list-card");d&&d.addEventListener("click",h)}else console.error("❌ 関連Insightsセクションが見つかりません:",e)}
